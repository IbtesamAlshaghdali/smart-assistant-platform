<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>المساعد الذكي</title>
  <link rel="stylesheet" href="./site.css" />

  <style>
    /* ===== Chat size tuning ===== */
    .chat-wrap{
      max-width: 720px;        /* ⬅️ أصغر من قبل */
      margin-inline:auto;
    }

    .chat-box{
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 260px;       /* ⬅️ أقل */
      max-height: 360px;       /* ⬅️ يمنع التمدد الزائد */
      overflow-y: auto;
      padding: 6px 2px;
    }

    .msg{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      line-height:1.8;
      max-width: 90%;
      word-wrap: break-word;
    }

    html[dir="rtl"] .msg.you{
      align-self:flex-end;
      text-align:right;
    }
    html[dir="rtl"] .msg.bot{
      align-self:flex-start;
      text-align:right;
      background: rgba(0,0,0,.18);
    }

    html[dir="ltr"] .msg.you{
      align-self:flex-start;
      text-align:left;
    }
    html[dir="ltr"] .msg.bot{
      align-self:flex-end;
      text-align:left;
      background: rgba(0,0,0,.18);
    }

    .chat-input{
      display:flex;
      gap:10px;
      margin-top:12px;
    }

    .chat-input input{
      flex:1;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color:#fff;
      font-size:15px;
    }

    .chat-input button{
      padding:12px 16px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color:#fff;
      cursor:pointer;
    }

    /* ===== Mobile ===== */
    @media (max-width: 900px){
      .chat-wrap{ max-width: 100%; }
      .chat-box{
        min-height: 45vh;
        max-height: 55vh;
      }
    }
  </style>
</head>

<body>
  <div class="hero-bg">

    <!-- ===== Header ===== -->
    <header>
      <div class="container">
        <div class="header-row">

          <div class="logo-wrap">
            <div class="logo">
              <img src="https://www.uoh.edu.sa/Ar/Deanships/Deanship-A-R/PublishingImages/IMG_9501.PNG" alt="شعار">
            </div>
            <div class="brand-text">
              <strong id="brandTitle">كلية إدارة الأعمال</strong>
              <span id="brandSub">جامعة حائل</span>
            </div>
          </div>

          <nav>
            <a class="nav-item" href="index.html">الرئيسية</a>
            <a class="nav-item" href="about.html">عن الموقع</a>
            <a class="nav-item" href="faq.html">الأسئلة الشائعة</a>
            <a class="nav-item" href="chatbot.html">المساعد الذكي</a>
            <a class="nav-item" href="contact.html">للتواصل</a>
          </nav>

          <div class="actions">
            <button class="icon-btn" id="langBtn" title="تغيير اللغة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 5h7"/><path d="M9 3v2"/>
                <path d="M6 21s3-3 3-7"/><path d="M4 9h7"/>
                <path d="M13 21l4-11 4 11"/><path d="M15 16h4"/>
              </svg>
            </button>

            <a class="icon-btn" href="admin-login.html" title="تسجيل دخول المشرف">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4z"/>
                <path d="M4 21a8 8 0 0 1 16 0"/>
              </svg>
            </a>
          </div>

        </div>
      </div>
    </header>

    <!-- ===== Page ===== -->
    <main class="page">
      <div class="container chat-wrap">
        <div class="glass">
          <h2 class="center" id="botTitle" style="margin:0 0 8px;">المساعد الذكي</h2>

          <div class="hint" style="margin-bottom:10px; opacity:.85;">
            <span id="botHint">جرّب تسأل: “تخصصات كلية إدارة الأعمال جامعة حائل”.</span>
          </div>

          <div id="chatBox" class="chat-box"></div>

          <div class="chat-input">
            <input id="chatInput" type="text" placeholder="اكتب سؤالك هنا..." />
            <button id="sendBtn" type="button">إرسال</button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="footer-row">
          <div class="rights" id="rights">جميع الحقوق محفوظة لجامعة حائل - كلية ادارة الأعمال 2025-2026</div>

          <div class="social" aria-label="روابط التواصل">
            <!-- X -->
            <a class="social-btn x" href="https://x.com/_UOH" target="_blank" rel="noopener" title="X" aria-label="X">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M18.244 2H21l-6.545 7.48L22 22h-6.828l-5.354-7.007L3.79 22H1l7.02-8.03L2 2h6.828l4.83 6.393L18.244 2z"/>
              </svg>
            </a>

            <!-- YouTube -->
            <a class="social-btn yt" href="https://www.youtube.com/@UOHTubeSA" target="_blank" rel="noopener" title="YouTube" aria-label="YouTube">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M23.498 6.186a2.99 2.99 0 0 0-2.105-2.117C19.505 3.5 12 3.5 12 3.5s-7.505 0-9.393.57A2.99 2.99 0 0 0 .502 6.186 31.2 31.2 0 0 0 0 12a31.2 31.2 0 0 0 .502 5.814 2.99 2.99 0 0 0 2.105 2.117C4.495 20.5 12 20.5 12 20.5s7.505 0 9.393-.57a2.99 2.99 0 0 0 2.105-2.117A31.2 31.2 0 0 0 24 12a31.2 31.2 0 0 0-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
              </svg>
            </a>

            <!-- SSO -->
            <a class="social-btn sso" href="https://login.uoh.edu.sa" target="_blank" rel="noopener" title="بوابة الدخول الموحد">SSO</a>

            <!-- UOH -->
            <a class="social-btn uoh" href="https://www.uoh.edu.sa/Ar/Colleges/B-Administration/Pages/default.aspx" target="_blank" rel="noopener" title="موقع كلية إدارة الأعمال">UOH</a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- ===== Script ===== -->
  <script type="module">
    import { initLang } from "./i18n.js";
    import { getBotAnswer, getLang } from "./database.js";

    initLang();

    const box = document.getElementById("chatBox");
    const input = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    const langBtn = document.getElementById("langBtn");

    function uiText(){
      const lang = getLang();
      return {
        placeholder: lang === "en" ? "Type your question here..." : "اكتب سؤالك هنا...",
        send:        lang === "en" ? "Send" : "إرسال",
        welcome:     lang === "en"
          ? "Hi! Ask me about the college, majors, study plan, or FAQs."
          : "مرحباً! اسأليني عن الكلية، التخصصات، الخطة الدراسية، أو الأسئلة الشائعة.",
        typing:      lang === "en" ? "Thinking…" : "جاري التفكير…",
        error:       lang === "en" ? "Error loading answer." : "صار خطأ في جلب الإجابة."
      };
    }

    function addMsg(text, who){
      const div = document.createElement("div");
      div.className = `msg ${who}`;
      div.textContent = text;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
      return div;
    }

    function resetWelcome(){
      const t = uiText();
      input.placeholder = t.placeholder;
      sendBtn.textContent = t.send;
      box.innerHTML = "";
      addMsg(t.welcome, "bot");
    }

    resetWelcome();

    async function send(){
      const q = input.value.trim();
      if(!q) return;
      input.value = "";

      addMsg(q, "you");
      const t = uiText();
      const loading = addMsg(t.typing, "bot");

      try{
        const a = await getBotAnswer(q);
        loading.textContent = a;
      }catch{
        loading.textContent = t.error;
      }
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", e => e.key === "Enter" && send());

    langBtn?.addEventListener("click", () => {
      requestAnimationFrame(() => resetWelcome());
    });
  </script>
</body>
</html>
